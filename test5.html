<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>p5.js Touch Text</title>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js"></script>
</head>
<body>
<script>
let marks = []; // {x, y, char, size, alpha, velY}

const letters = "가나다라마바사아자차카타파하힣0123456789abcdefghijklmnopqrstuvwxyz";

function setup() {
  createCanvas(windowWidth, windowHeight);
  textAlign(CENTER, CENTER);
  textSize(32);
  noStroke();
  fill(255);
  background(30);
}

function draw() {
  // 반투명 배경으로 잔상(또는 background(30)로 완전 리셋)
  background(30, 30, 30, 200);

  // 각 마크 업데이트 및 렌더링
  for (let i = marks.length - 1; i >= 0; i--) {
    const m = marks[i];

    // 위치/효과 업데이트 (위로 천천히 떠오르며 투명해짐)
    m.y += m.velY;
    m.alpha -= 2; // 작을수록 더 오래 남음
    m.size *= 0.999; // 살짝 줄어듦

    push();
    translate(m.x, m.y);
    fill(255, m.alpha);
    textSize(m.size);
    text(m.char, 0, 0);
    pop();

    // 제거 조건
    if (m.alpha <= 0.5 || m.size < 4) {
      marks.splice(i, 1);
    }
  }
}

// 터치 시작(멀티터치 지원)
function touchStarted() {
  // touches 배열에는 현재 화면의 모든 터치 포인트가 담겨있음
  for (let t of touches) {
    addMark(t.x, t.y);
  }
  // 모바일에서 기본 스크롤 막기
  return false;
}

// 터치 이동 시 계속 추가 (드래그 효과)
function touchMoved() {
  for (let t of touches) {
    addMark(t.x, t.y);
  }
  return false;
}

// 데스크탑 테스트용: 마우스 클릭/드래그도 동일하게 동작
function mousePressed() {
  addMark(mouseX, mouseY);
}

function mouseDragged() {
  addMark(mouseX, mouseY);
}

// 새로운 마크 생성 함수
function addMark(x, y) {
  const c = randomChar();
  const s = random(20, 64);      // 글자 크기
  const a = random(180, 255);    // 초기 알파
  const v = random(-0.6, -1.6);  // y 속도 (위로 떠오름)
  marks.push({ x: x, y: y, char: c, size: s, alpha: a, velY: v });
}

// 랜덤 글자 선택 (원하면 임의의 문자열로 교체)
function randomChar() {
  return letters.charAt(floor(random(letters.length)));
}

// 창 크기 변경 처리
function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
}
</script>
</body>
</html>
